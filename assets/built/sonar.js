function buildChecks(){var t=document.getElementById("toc-list");if(t){var o,r=document.querySelectorAll("[data-slug]"),n=[location.pathname];let e;null!=(o=JSON.parse(localStorage.getItem("ugPrefs")))?n in o&&(e=o[n]):e={};for(tag of r){var a=document.createElement("li"),i=(a.className="toc-list-item",document.createElement("input")),s=(i.type="checkbox",i.value=tag.id,i.name=tag.textContent.trim(),i.addEventListener("click",checkBoxHandler.bind(null,i.value)),document.createElement("label"));s.htmlFor=i.value,s.textContent=tag.textContent.trim(),i.classList="mr-4 form-check text-primary-900 dark:text-accent-400 rounded",s.classList="text-primary-900 dark:text-accent-400 font-medium",t.appendChild(a),a.appendChild(i),a.appendChild(s),null!=e&&i.value in e&&(i.checked=!0)}firstRender()}}function checkBoxHandler(e,t){var o=getBoxes("CHECKED"),r=getBoxes("UNCHECKED"),n=getBoxes("CATEGORIES");if(0==o.length)n.forEach(e=>e.classList.remove("hidden"));else if(1==o.length)for(category of n)for(uncheck of r)category.dataset.visibility==uncheck.value&&category.classList.add("hidden");else document.querySelector(`[data-visibility=${CSS.escape(e)}]`).classList.toggle("hidden");setPreferences()}function firstRender(){var e=getBoxes("CHECKED");if(0<e.length)for(uncheck of getBoxes("UNCHECKED"))document.querySelector(`[data-visibility=${CSS.escape(uncheck.value)}]`).classList.toggle("hidden")}function setPreferences(){let e=JSON.parse(localStorage.getItem("ugPrefs"));null===e&&((e={})[location.pathname]={});var t={},o=getBoxes("CHECKED");if(0<o.length)for(check of o)t[""+check.value]=!0;e[location.pathname]=t,localStorage.setItem("ugPrefs",JSON.stringify(e))}function getBoxes(e){switch(e){case"CHECKED":return document.querySelectorAll("input:checked");case"UNCHECKED":return document.querySelectorAll("input:not(:checked)");case"CATEGORIES":return document.querySelectorAll("[data-visibility]");case"BOXES":return document.querySelectorAll('input[type="checkbox"]')}}function getPreferences(){return sanitizePreferences([location.pathname],2e3)}function sanitizePreferences(e,t){if(null===(r=localStorage.getItem("ugPrefs")))return{};if(r.length>t)return{};var o=[];for(categoryDiv of getBoxes("BOXES"))o.push(categoryDiv.value);var r,n={};for(initialPref in JSON.parse(localStorage.getItem("ugPrefs"))[e])o.includes(initialPref)&&(n[""+initialPref]=!0);return n}!function(a){"use strict";a.fn.fitVids=function(e){var t,o,n={customSelector:null,ignore:null};return document.getElementById("fit-vids-style")||(t=document.head||document.getElementsByTagName("head")[0],(o=document.createElement("div")).innerHTML='<p>x</p><style id="fit-vids-style">.fluid-width-video-container{flex-grow: 1;width:100%;}.fluid-width-video-wrapper{width:100%;position:relative;padding:0;}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper object,.fluid-width-video-wrapper embed {position:absolute;top:0;left:0;width:100%;height:100%;}</style>',t.appendChild(o.childNodes[1])),e&&a.extend(n,e),this.each(function(){var e=['iframe[src*="player.vimeo.com"]','iframe[src*="youtube.com"]','iframe[src*="youtube-nocookie.com"]','iframe[src*="kickstarter.com"][src*="video.html"]',"object","embed"],r=(n.customSelector&&e.push(n.customSelector),".fitvidsignore"),e=(n.ignore&&(r=r+", "+n.ignore),a(this).find(e.join(",")));(e=(e=e.not("object object")).not(r)).each(function(){var e,t,o=a(this);0<o.parents(r).length||"embed"===this.tagName.toLowerCase()&&o.parent("object").length||o.parent(".fluid-width-video-wrapper").length||(o.css("height")||o.css("width")||!isNaN(o.attr("height"))&&!isNaN(o.attr("width"))||(o.attr("height",9),o.attr("width",16)),e=("object"===this.tagName.toLowerCase()||o.attr("height")&&!isNaN(parseInt(o.attr("height"),10))?parseInt(o.attr("height"),10):o.height())/(isNaN(parseInt(o.attr("width"),10))?o.width():parseInt(o.attr("width"),10)),o.attr("name")||(t="fitvid"+a.fn.fitVids._count,o.attr("name",t),a.fn.fitVids._count++),o.wrap('<div class="fluid-width-video-container"><div class="fluid-width-video-wrapper"></div></div>').parent(".fluid-width-video-wrapper").css("padding-top",100*e+"%"),o.removeAttr("height").removeAttr("width"))})})},a.fn.fitVids._count=0}(window.jQuery||window.Zepto),$(".postItem:empty").parent().remove(),buildChecks(),window.addEventListener("DOMContentLoaded",function(){const n=document.querySelector("#create-exam-form"),o=document.querySelector("#form-message"),a=document.querySelector("#categories-container");function i(e,t){o&&(o.className="mt-4 p-4 rounded-md","success"===e?o.classList.add("bg-green-100","text-green-800","border","border-green-300"):"error"===e?o.classList.add("bg-red-100","text-red-800","border","border-red-300"):"info"===e&&o.classList.add("bg-blue-100","text-blue-800","border","border-blue-300"),o.textContent=t,o.classList.remove("hidden"),"info"===e)&&setTimeout(()=>{o.classList.add("hidden")},3e3)}n?(fetch("http://127.0.0.1:8000/api/v1/tags/").then(e=>{if(e.ok)return e.json();throw new Error("HTTP error! status: "+e.status)}).then(e=>{e&&0!==e.length?(a.innerHTML="",e.forEach((e,t)=>{var o=document.createElement("div"),r=(o.className="flex items-center","category-"+(e.id||t));const n=document.createElement("input");n.type="checkbox",n.id=r,n.name="categories",n.value=e.slug||e.name,n.setAttribute("data-tag-name",e.name),n.setAttribute("data-tag-id",e.id||t),n.className="exam-category h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded";t=document.createElement("label");t.htmlFor=r,t.className="ml-2 text-sm text-gray-700 cursor-pointer",t.textContent=e.name,o.addEventListener("click",function(e){e.target!==n&&(e.preventDefault(),n.checked=!n.checked)}),o.appendChild(n),o.appendChild(t),a.appendChild(o)})):a.innerHTML='<div class="text-red-500 text-sm">No categories available</div>'}).catch(e=>{console.error("Error loading categories:",e),a.innerHTML='<div class="text-red-500 text-sm">Failed to load categories</div>'}),n.addEventListener("submit",function(e){e.preventDefault();e=document.querySelector("#exam-history"),e=e?e.dataset.memberId:null;if(e){const r=document.querySelector("#question-count").value;var t=Array.from(document.querySelectorAll("input.exam-category:checked")).map(e=>({name:e.getAttribute("data-tag-name"),id:e.getAttribute("data-tag-id")})),o=document.querySelector('input[name="questionSelection"]:checked').value,e={member_id:e,question_count:parseInt(r),tags:t};"all"!==o&&(e.filters=[o]),console.log("Creating exam with data:",e),n.querySelector('button[type="submit"]').disabled=!0,fetch("http://127.0.0.1:8000/api/v1/exams",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>{if(e.ok)return e.json();throw new Error("HTTP error! status: "+e.status)}).then(e=>{i("success",`Exam created successfully with ${e.question_count||r} questions!`),n.reset(),window.loadExamHistory?setTimeout(()=>{window.loadExamHistory()},1e3):i("success","Exam created! Refresh the page to see it in your history.")}).catch(e=>{console.error("Error creating exam:",e),i("error","Failed to create exam. Please try again.")}).finally(()=>{n.querySelector('button[type="submit"]').disabled=!1})}else i("error","Member ID not found. Please log in again.")})):console.log("Exam creator form not found on this page")}),window.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("#exam-history");e&&((e=e.dataset.memberId)?(console.log("Member ID found:",e),fetch("http://127.0.0.1:8000/api/v1/exams/user/"+e).then(e=>e.json()).then(e=>{console.log("Exam data:",e);const a=document.querySelector("#exam-list");var t=document.querySelector("#no-exams-message");const i=document.querySelector("#exam-item-template");e&&e.exams&&0!==e.exams.length?(a.innerHTML="",e.exams.forEach(e=>{var t=e.started_at.endsWith("Z")?e.started_at:e.started_at+"Z",t=new Date(t).toLocaleString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0}),o=e.tags?e.tags.map(e=>e.name).join(", "):"",r=e.question_count||e.questions?.length||0,e=e.completed_at||!1,n=i.content.cloneNode(!0),t=(n.querySelector(".exam-date").textContent=t,n.querySelector(".exam-question-count").textContent=1===r?r+" Question":r+" Questions",n.querySelector(".exam-tags").textContent=o,n.querySelector(".exam-status-complete")),r=n.querySelector(".exam-status-progress");(e?t:r).classList.remove("hidden"),a.appendChild(n)})):t.classList.remove("hidden")}).catch(e=>{console.error("Error fetching exams:",e),document.querySelector("#error-message").classList.remove("hidden")})):console.error("No member ID found on #exam-history element"))});var firebaseConfig={apiKey:"AIzaSyCM0FHbolc3QT-PfoLixcoeVS3JoWhheEg",authDomain:"ultrasound-guidance.firebaseapp.com",projectId:"ultrasound-guidance",storageBucket:"ultrasound-guidance.appspot.com",messagingSenderId:"947728965057",appId:"1:947728965057:web:32b2bb26469a78c9762340"};firebase.initializeApp(firebaseConfig);const firebaseDB=firebase.firestore();var modal=document.getElementById("myModal"),formContainer=document.querySelector(".form"),submit=document.querySelector(".submit-form"),closeBtn=document.getElementById("closeBtn"),postData=document.querySelector("#post"),iframes=document.querySelectorAll("iframe"),formName="Default";function getForm(){firebaseDB.collection("forms").doc("Default").get().then(e=>{e.exists&&e.data().items.slice().reverse().forEach(e=>{e=`
            <label>${e.title}</label><br>
            <input type="text" style="width: 100%;" id="${e.itemId}" ></br>
            `;formContainer.insertAdjacentHTML("afterbegin",e)})}).catch(e=>{console.log("Error getting document:",e)})}closeBtn&&closeBtn.addEventListener("click",()=>{modal.style.display="none"}),window.onclick=function(e){e.target==modal&&(modal.style.display="none")},submit&&(submit.onclick=function(e){e.preventDefault();var e=document.querySelectorAll("input"),t={};e.forEach(e=>{t[e.id]={questionId:e.id,textAnswers:{answers:[{value:e.value}]}}}),player.getVideoId().then(e=>{firebaseDB.collection("formResponses").doc(formName).set({responses:{[postData.dataset.memberEmail]:firebase.firestore.FieldValue.arrayUnion({responseId:crypto.randomUUID(),videoId:e,createTime:(new Date).toISOString(),answers:t})}},{merge:!0}).then(()=>{modal.style.display="none"}).catch(e=>{console.error("Error submitting form: ",e)})})}),postData&&iframes&&iframes.forEach(e=>{var r=new Vimeo.Player(e);r.getVideoId().then(t=>{firebaseDB.collection("users").doc(postData.dataset.memberEmail).get().then(e=>{e.exists?(e=e.data().watchedVideosProgress[postData.dataset.postId][t].watchedSeconds,r.setCurrentTime(e).then(()=>{}).catch(e=>{e.name})):console.log("Unable to get Video watched seconds: No such document")}).catch(e=>{console.log("No document found:",e)})}),r.on("play",()=>{r.getVideoId().then(e=>{var t=document.querySelectorAll(".kg-embed-card").length;firebaseDB.collection("users").doc(postData.dataset.memberEmail).set({watchedVideosProgress:{[postData.dataset.postId]:{[e]:{postId:postData.dataset.postId,videoId:e},videoCount:t}}},{merge:!0}).catch(e=>{console.error("Error adding document: ",e)})})}),r.on("pause",()=>{r.getCurrentTime().then(o=>{r.getDuration().then(t=>{r.getVideoId().then(e=>{firebaseDB.collection("users").doc(postData.dataset.memberEmail).set({watchedVideosProgress:{[postData.dataset.postId]:{[e]:{watchedSeconds:o-5,progressPosition:o/t}}}},{merge:!0}).catch(e=>{console.error("Error updating document: ",e)})})})})}),r.on("ended",()=>{r.getCurrentTime().then(e=>{firebaseDB.collection("users").doc(postData.dataset.memberEmail).set({watchedVideos:{[postData.dataset.postId]:{watchedSeconds:60,progressPosition:1}}},{merge:!0}).then(()=>{r.off("pause")}).catch(e=>{console.error("Error updating document on end event: ",e)})})})}),function(e){e.addEventListener("DOMContentLoaded",function(){e.querySelectorAll(".kg-gallery-image img").forEach(function(e){var t=e.closest(".kg-gallery-image"),o=e.attributes.width.value,e=e.attributes.height.value;t.style.flex=o/e+" 1 0%"})})}((window,document)),function(t,o){var r,n,a,i,s,c,d,l=o.querySelector("link[rel=next]");function u(){var e;404===this.status?(t.removeEventListener("scroll",h),t.removeEventListener("resize",g)):(this.response.querySelectorAll("article.post-card").forEach(function(e){r.appendChild(o.importNode(e,!0))}),(e=this.response.querySelector("link[rel=next]"))?l.href=e.href:(t.removeEventListener("scroll",h),t.removeEventListener("resize",g)),d=o.documentElement.scrollHeight,i=a=!1)}function e(){var e;i||(s+c<=d-n?a=!1:(i=!0,(e=new t.XMLHttpRequest).responseType="document",e.addEventListener("load",u),e.open("GET",l.href),e.send(null)))}function m(){a||t.requestAnimationFrame(e),a=!0}function h(){s=t.scrollY,m()}function g(){c=t.innerHeight,d=o.documentElement.scrollHeight,m()}l&&(r=o.querySelector(".post-feed"))&&(i=a=!(n=300),s=t.scrollY,c=t.innerHeight,d=o.documentElement.scrollHeight,t.addEventListener("scroll",h,{passive:!0}),t.addEventListener("resize",g),m())}(window,document),window.addEventListener("load",function(){var e=document.querySelector(".postItem");e&&firebaseDB.collection("users").doc(e.dataset.memberEmail).get().then(e=>{if(e.exists){e=e.data().watchedVideosProgress;let r=1;Object.entries(e).forEach(([e,t])=>{t.videoCount&&(r=t.videoCount);let o=0;Object.entries(t).forEach(([,e])=>{e.progressPosition&&(o+=e.progressPosition)}),document.getElementById(e).style.setProperty("--progress-position",o/r)})}else console.log("No such document!")}).catch(e=>{console.log("Error getting document:",e)})});
//# sourceMappingURL=sonar.js.map